<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Query Page</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .query-page-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .query-page-main-content {
      flex: 1;
      background: white;
      padding: 16px;
    }

    .query-page-title {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      color: #1e3a8a;
      margin-bottom: 16px;
    }

    .query-response-box {
      background: #f9f9f9;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border: 1px solid #ccc;
      font-size: 1.1rem;
      line-height: 1.6;
      color: #333;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    .query-input-container {
      background: #f0f0f0;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid #ccc;
    }

    .query-submit-btn {
      background: #2563eb;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    .query-submit-btn:hover {
      background: #1e40af;
    }

    .query-text-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 16px;
      border-radius: 8px;
      max-width: 600px;
      width: 100%;
    }

    .scroll-to-top {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: #2563eb;
      color: white;
      padding: 8px;
      border-radius: 50%;
      display: none;
    }

    .scroll-to-top.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="query-page-container">
    <div class="query-page-main-content">
      <h2 class="query-page-title">Ask a Query</h2>

      <button id="infoButton" class="query-submit-btn">How It Works</button>

      <div id="responseBox" class="query-response-box">Response will appear here...</div>

      <div class="query-input-container">
        <input
          id="queryInput"
          class="query-text-input"
          type="text"
          placeholder="Type your query here..."
        />
        <button id="submitQuery" class="query-submit-btn">Submit</button>
      </div>
    </div>

    <div id="modal" class="modal-overlay" style="display: none;">
      <div class="modal-content">
        <h3>How the Chatbot Works</h3>
        <p>The chatbot helps law enforcement officers by providing information...</p>
        <button id="closeModal" class="query-submit-btn">Close</button>
      </div>
    </div>

    <button id="scrollToTop" class="scroll-to-top">â†‘</button>
  </div>

  <script>
    const infoButton = document.getElementById('infoButton');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const queryInput = document.getElementById('queryInput');
    const submitQuery = document.getElementById('submitQuery');
    const responseBox = document.getElementById('responseBox');
    const scrollToTop = document.getElementById('scrollToTop');

    const parseMarkdownToHTML = (text) => {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br />');
    };

    // Scroll to top button logic
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        scrollToTop.classList.add('show');
      } else {
        scrollToTop.classList.remove('show');
      }
    });

    scrollToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Modal logic
    infoButton.addEventListener('click', () => {
      modal.style.display = 'flex';
    });

    closeModal.addEventListener('click', () => {
      modal.style.display = 'none';
    });

    // Submit query logic
    submitQuery.addEventListener('click', async () => {
      const query = queryInput.value.trim();
      if (!query) return;

      const fullQuery = `${query}. You are an AI assistant with in-depth expertise in the Indian Constitution, criminal law, and all relevant acts, sections, and legal provisions. Your role is to support law enforcement officers in the process of filing a First Information Report (FIR) by identifying and listing all applicable laws, including relevant acts, sections, and provisions. For each act or section, provide a concise yet comprehensive explanation of its significance, its direct relevance to the case, and how it should be applied in the context of the incident. Ensure that no pertinent legal provision is overlooked, and that the officer is equipped with a thorough understanding of the laws involved, enabling them to file a complete and legally sound FIR.

If you receive any queries unrelated to the filing of an FIR, legal provisions, or related matters, politely refuse to answer and explain that you can only assist with legal matters. Additionally, if a user does not provide sufficient details regarding the event or incident for which they seek assistance, respond with a default message requesting the necessary details of the event in order to provide relevant legal assistance.

For example, if the officer does not provide case specifics, respond with:
"To assist you in filing a legally accurate FIR, I need more details about the incident. Could you please provide information about the event, such as the nature of the crime, involved parties, location, and any other relevant facts?"`;

      try {
        const response = await fetch('https://chatbot-for-fir-backend.vercel.app/api/gemini/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: fullQuery }),
        });

        const data = await response.json();
        const parsedResponse = parseMarkdownToHTML(data.response || 'No response received');
        responseBox.innerHTML = parsedResponse;
      } catch (error) {
        responseBox.textContent = 'Error occurred while fetching the response';
        console.error(error);
      }

      queryInput.value = ''; // Clear the input field after submission
    });
  </script>
</body>
</html>
