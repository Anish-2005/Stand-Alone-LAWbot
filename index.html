<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Query Page</title>
  <script src="https://cdn.tailwindcss.com"></script> <!-- Tailwind CDN -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .query-page-container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .query-page-main-content {
      flex: 1;
      background: white;
      padding: 16px;
    }

    .query-page-title {
      font-size: 2rem;
      font-weight: bold;
      text-align: center;
      color: #1e3a8a;
      margin-bottom: 0px;
    }

    .query-response-box {
      background: #f9f9f9;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
      border: 1px solid #ccc;
      font-size: 1.1rem;
      line-height: 1.6;
      color: #333;
      white-space: pre-wrap;
      overflow-x: auto;
    }

    .query-input-container {
      background: #f0f0f0;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      border: 1px solid #ccc;
    }

    .query-submit-btn {
      background: #2563eb;
      color: white;
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }

    .query-submit-btn:hover {
      background: #1e40af;
    }

    .query-text-input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .modal-content {
      background: white;
      padding: 16px;
      border-radius: 8px;
      max-width: 600px;
      width: 100%;
    }

    .scroll-to-top {
      position: fixed;
      bottom: 16px;
      right: 16px;
      background: #2563eb;
      color: white;
      padding: 8px;
      border-radius: 50%;
      display: none;
    }

    .scroll-to-top.show {
      display: block;
    }
  </style>
</head>
<body>
  <div class="query-page-container">
    <div class="query-page-main-content">
      <h2 class="query-page-title">Ask a Query</h2>
      <p style="font-size: 1rem; text-align: center; color: #1e3a8a;">(sandbox prototype for testing and review)</p>

      <div class="flex justify-center pt-4">
        <button id="infoButton" class="query-submit-btn py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none transition duration-200">
          How It Works
        </button>
      </div>
      <div id="responseBox" class="query-response-box bg-gray-50 p-4 rounded-lg border border-gray-300 text-gray-700 mt-4">
        Response will appear here...
      </div>
      
      <div class="query-input-container mt-6 space-y-4">
        <input
          id="queryInput"
          class="query-text-input w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          type="text"
          placeholder="Type your query here..."
        />
        <div class="flex justify-center pt-4">
          <button id="submitQuery" class="py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-blue-700 focus:outline-none transition duration-200">
            Submit
          </button>
        </div>
      </div>
      
      <!-- Modal -->
      <div id="modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50 hidden">
        <div class="modal-content bg-white p-6 rounded-xl shadow-lg max-w-md w-full">
          <h3 class="text-2xl font-semibold text-blue-800">How it Works</h3>
          <p class="text-gray-700 mt-4">Type in any criminal incident and the model will try to determine the acts and sections applicable with the incident.</p>
          <div class="flex justify-center pt-4">
            <button id="closeModal" class="mt-4 py-2 px-6 bg-blue-600 text-white font-semibold rounded-lg hover:bg-red-700 focus:outline-none transition duration-200">
              Close
            </button>
          </div>
          
        </div>
      </div>
      
      <button id="scrollToTop" class="fixed bottom-6 right-6 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 transition duration-200 hidden">
        â†‘
      </button>
      
      

  <script>
    const infoButton = document.getElementById('infoButton');
    const modal = document.getElementById('modal');
    const closeModal = document.getElementById('closeModal');
    const queryInput = document.getElementById('queryInput');
    const submitQuery = document.getElementById('submitQuery');
    const responseBox = document.getElementById('responseBox');
    const scrollToTop = document.getElementById('scrollToTop');

    const parseMarkdownToHTML = (text) => {
      return text
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br />');
    };

    // Scroll to top button logic
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        scrollToTop.classList.add('show');
      } else {
        scrollToTop.classList.remove('show');
      }
    });

    scrollToTop.addEventListener('click', () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Modal logic
    infoButton.addEventListener('click', () => {
      modal.style.display = 'flex';
    });

    closeModal.addEventListener('click', () => {
      modal.style.display = 'none';
    });


// Trigger the submit query button when Enter is pressed
queryInput.addEventListener('keypress', (event) => {
  if (event.key === 'Enter') {
    submitQuery.click(); // Simulate a click on the submit button
  }
});

submitQuery.addEventListener('click', async () => {
  const query = queryInput.value.trim();
  if (!query) return;

  const fullQuery = `${query}.You are an AI assistant with in-depth expertise in the Indian Constitution, criminal law, and all relevant acts, sections, and legal provisions. Your role is to support law enforcement officers in the process of filing a First Information Report (FIR) by identifying and listing all applicable laws, including relevant acts, sections, and provisions. For each act or section, provide a concise yet comprehensive explanation of its significance, its direct relevance to the case, and how it should be applied in the context of the incident. Ensure that no pertinent legal provision is overlooked, and that the officer is equipped with a thorough understanding of the laws involved, enabling them to file a complete and legally sound FIR.
After listing alll the acts, dont give any disclaimers. Just provide the below given text. 

"Applying the Laws in the FIR:

The FIR should meticulously detail:

 Date, time, and location of the incident.
 Detailed description of the stolen property with estimated value.
 Circumstances of the burglary (e.g., forced entry, time of day).
 Names and addresses of the complainants and witnesses (if any).
 Any evidence collected (e.g., fingerprints, CCTV footage).
 Specific sections of the IPC that are applicable based on the evidence gathered.


This comprehensive approach ensures a legally sound and complete FIR, maximizing the chances of successful prosecution. The investigating officer should carefully consider the evidence and apply the relevant sections accordingly. Remember, this is a guide, and the specific charges will depend on the specific facts of the case as they are investigated and revealed."`;

      try {
        const response = await fetch('https://chatbot-for-fir-backend.vercel.app/api/gemini/generate', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ query: fullQuery }),
        });

        const data = await response.json();
        const parsedResponse = parseMarkdownToHTML(data.response || 'No response received');
        responseBox.innerHTML = parsedResponse;
      } catch (error) {
        responseBox.textContent = 'Error occurred while fetching the response';
        console.error(error);
      }

      queryInput.value = ''; // Clear the input field after submission
    });
  </script>
</body>
</html>
